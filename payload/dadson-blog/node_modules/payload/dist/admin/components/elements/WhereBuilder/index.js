"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "default", {
    enumerable: true,
    get: function() {
        return _default;
    }
});
const _qs = /*#__PURE__*/ _interop_require_default(require("qs"));
const _react = /*#__PURE__*/ _interop_require_wildcard(require("react"));
const _reacti18next = require("react-i18next");
const _reactrouterdom = require("react-router-dom");
const _types = require("../../../../exports/types");
const _flattenTopLevelFields = /*#__PURE__*/ _interop_require_default(require("../../../../utilities/flattenTopLevelFields"));
const _getTranslation = require("../../../../utilities/getTranslation");
const _useThrottledEffect = /*#__PURE__*/ _interop_require_default(require("../../../hooks/useThrottledEffect"));
const _createNestedFieldPath = require("../../forms/Form/createNestedFieldPath");
const _SearchParams = require("../../utilities/SearchParams");
const _Button = /*#__PURE__*/ _interop_require_default(require("../Button"));
const _FieldSelect = require("../FieldSelect");
const _Condition = /*#__PURE__*/ _interop_require_default(require("./Condition"));
const _fieldtypes = /*#__PURE__*/ _interop_require_default(require("./field-types"));
require("./index.scss");
const _reducer = /*#__PURE__*/ _interop_require_default(require("./reducer"));
const _transformWhereQuery = require("./transformWhereQuery");
const _validateWhereQuery = /*#__PURE__*/ _interop_require_default(require("./validateWhereQuery"));
function _interop_require_default(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
function _getRequireWildcardCache(nodeInterop) {
    if (typeof WeakMap !== "function") return null;
    var cacheBabelInterop = new WeakMap();
    var cacheNodeInterop = new WeakMap();
    return (_getRequireWildcardCache = function(nodeInterop) {
        return nodeInterop ? cacheNodeInterop : cacheBabelInterop;
    })(nodeInterop);
}
function _interop_require_wildcard(obj, nodeInterop) {
    if (!nodeInterop && obj && obj.__esModule) {
        return obj;
    }
    if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
        return {
            default: obj
        };
    }
    var cache = _getRequireWildcardCache(nodeInterop);
    if (cache && cache.has(obj)) {
        return cache.get(obj);
    }
    var newObj = {
        __proto__: null
    };
    var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;
    for(var key in obj){
        if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {
            var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;
            if (desc && (desc.get || desc.set)) {
                Object.defineProperty(newObj, key, desc);
            } else {
                newObj[key] = obj[key];
            }
        }
    }
    newObj.default = obj;
    if (cache) {
        cache.set(obj, newObj);
    }
    return newObj;
}
const baseClass = 'where-builder';
const reduceFields = (fields, i18n, labelPrefix, pathPrefix)=>(0, _flattenTopLevelFields.default)(fields).reduce((reduced, field)=>{
        let operators = [];
        if (field.admin && 'disableListFilter' in field.admin && field.admin?.disableListFilter) return reduced;
        if (field.type === 'group' && 'fields' in field) {
            const translatedLabel = (0, _getTranslation.getTranslation)(field.label || '', i18n);
            const labelWithPrefix = labelPrefix ? translatedLabel ? labelPrefix + ' > ' + translatedLabel : labelPrefix : translatedLabel;
            const pathWithPrefix = field.name ? pathPrefix ? pathPrefix + '.' + field.name : field.name : pathPrefix;
            reduced.push(...reduceFields(field.fields, i18n, labelWithPrefix, pathWithPrefix));
            return reduced;
        }
        if (field.type === 'tab' && 'tabs' in field) {
            const tabs = field.tabs;
            tabs.forEach((tab)=>{
                if (typeof tab.label !== 'boolean') {
                    const localizedTabLabel = (0, _getTranslation.getTranslation)(tab.label, i18n);
                    const labelWithPrefix = labelPrefix ? labelPrefix + ' > ' + localizedTabLabel : localizedTabLabel;
                    const tabPathPrefix = (0, _types.tabHasName)(tab) && tab.name ? pathPrefix ? pathPrefix + '.' + tab.name : tab.name : pathPrefix;
                    if (typeof localizedTabLabel === 'string') {
                        reduced.push(...reduceFields(tab.fields, i18n, labelWithPrefix, tabPathPrefix));
                    }
                }
            });
            return reduced;
        }
        if (field.type === 'row' && 'fields' in field) {
            reduced.push(...reduceFields(field.fields, i18n, labelPrefix, pathPrefix));
            return reduced;
        }
        if (field.type === 'collapsible' && 'fields' in field) {
            const localizedTabLabel = (0, _getTranslation.getTranslation)(field.label || '', i18n);
            const labelWithPrefix = labelPrefix ? labelPrefix + ' > ' + localizedTabLabel : localizedTabLabel;
            reduced.push(...reduceFields(field.fields, i18n, labelWithPrefix, pathPrefix));
            return reduced;
        }
        if (typeof _fieldtypes.default[field.type] === 'object') {
            if (typeof _fieldtypes.default[field.type].operators === 'function') {
                operators = _fieldtypes.default[field.type].operators('hasMany' in field && field.hasMany ? true : false);
            } else {
                operators = _fieldtypes.default[field.type].operators;
            }
            const operatorKeys = new Set();
            const reducedOperators = operators.reduce((acc, operator)=>{
                if (!operatorKeys.has(operator.value)) {
                    operatorKeys.add(operator.value);
                    return [
                        ...acc,
                        {
                            ...operator,
                            label: i18n.t(`operators:${operator.label}`)
                        }
                    ];
                }
                return acc;
            }, []);
            const localizedLabel = (0, _getTranslation.getTranslation)(field.label || field.name, i18n);
            const formattedLabel = labelPrefix ? (0, _FieldSelect.combineLabel)(labelPrefix, field, i18n) : localizedLabel;
            const formattedValue = pathPrefix ? (0, _createNestedFieldPath.createNestedFieldPath)(pathPrefix, field) : field.name;
            const formattedField = {
                label: formattedLabel,
                value: formattedValue,
                ..._fieldtypes.default[field.type],
                operators: reducedOperators,
                props: {
                    ...field
                }
            };
            reduced.push(formattedField);
            return reduced;
        }
        return reduced;
    }, []);
/**
 * The WhereBuilder component is used to render the filter controls for a collection's list view.
 * It is part of the {@link ListControls} component which is used to render the controls (search, filter, where).
 */ const WhereBuilder = (props)=>{
    const { collection: { labels: { plural } = {} } = {}, collection, handleChange, modifySearchQuery = true } = props;
    const history = (0, _reactrouterdom.useHistory)();
    const params = (0, _SearchParams.useSearchParams)();
    const { i18n, t } = (0, _reacti18next.useTranslation)('general');
    // This handles initializing the where conditions from the search query (URL). That way, if you pass in
    // query params to the URL, the where conditions will be initialized from those and displayed in the UI.
    // Example: /admin/collections/posts?where[or][0][and][0][text][equals]=example%20post
    const [conditions, dispatchConditions] = (0, _react.useReducer)(_reducer.default, params.where, (whereFromSearch)=>{
        if (modifySearchQuery && whereFromSearch) {
            if ((0, _validateWhereQuery.default)(whereFromSearch)) {
                return whereFromSearch.or;
            }
            // Transform the where query to be in the right format. This will transform something simple like [text][equals]=example%20post to the right format
            const transformedWhere = (0, _transformWhereQuery.transformWhereQuery)(whereFromSearch);
            if ((0, _validateWhereQuery.default)(transformedWhere)) {
                return transformedWhere.or;
            }
            console.warn('Invalid where query in URL. Ignoring.');
        }
        return [];
    });
    const [reducedFields] = (0, _react.useState)(()=>reduceFields(collection.fields, i18n, null, null));
    // This handles updating the search query (URL) when the where conditions change
    (0, _useThrottledEffect.default)(()=>{
        const currentParams = _qs.default.parse(history.location.search, {
            depth: 10,
            ignoreQueryPrefix: true
        });
        const paramsToKeep = typeof currentParams?.where === 'object' && 'or' in currentParams.where ? currentParams.where.or.reduce((keptParams, param)=>{
            const newParam = {
                ...param
            };
            if (param.and) {
                delete newParam.and;
            }
            return [
                ...keptParams,
                newParam
            ];
        }, []) : [];
        const hasNewWhereConditions = conditions.length > 0;
        const newWhereQuery = {
            ...typeof currentParams?.where === 'object' && ((0, _validateWhereQuery.default)(currentParams?.where) || !hasNewWhereConditions) ? currentParams.where : {},
            or: [
                ...conditions,
                ...paramsToKeep
            ]
        };
        const reducedQuery = {
            or: newWhereQuery.or.map((orCondition)=>{
                const andConditions = (orCondition.and || []).map((andCondition)=>{
                    const reducedCondition = {};
                    Object.entries(andCondition).forEach(([fieldName, fieldValue])=>{
                        Object.entries(fieldValue).forEach(([operatorKey, operatorValue])=>{
                            reducedCondition[fieldName] = {};
                            reducedCondition[fieldName][operatorKey] = !operatorValue ? undefined : operatorValue;
                        });
                    });
                    return reducedCondition;
                });
                return {
                    and: andConditions
                };
            })
        };
        if (handleChange) handleChange(newWhereQuery);
        const hasExistingConditions = typeof currentParams?.where === 'object' && 'or' in currentParams.where;
        if (modifySearchQuery && (hasExistingConditions && !hasNewWhereConditions || hasNewWhereConditions)) {
            history.replace({
                search: _qs.default.stringify({
                    ...currentParams,
                    page: 1,
                    where: reducedQuery
                }, {
                    addQueryPrefix: true
                })
            });
        }
    }, 500, [
        conditions,
        modifySearchQuery,
        handleChange
    ]);
    return /*#__PURE__*/ _react.default.createElement("div", {
        className: baseClass
    }, conditions.length > 0 && /*#__PURE__*/ _react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/ _react.default.createElement("div", {
        className: `${baseClass}__label`
    }, t('filterWhere', {
        label: (0, _getTranslation.getTranslation)(plural, i18n)
    })), /*#__PURE__*/ _react.default.createElement("ul", {
        className: `${baseClass}__or-filters`
    }, conditions.map((or, orIndex)=>/*#__PURE__*/ _react.default.createElement("li", {
            key: orIndex
        }, orIndex !== 0 && /*#__PURE__*/ _react.default.createElement("div", {
            className: `${baseClass}__label`
        }, t('or')), /*#__PURE__*/ _react.default.createElement("ul", {
            className: `${baseClass}__and-filters`
        }, Array.isArray(or?.and) && or.and.map((_, andIndex)=>/*#__PURE__*/ _react.default.createElement("li", {
                key: andIndex
            }, andIndex !== 0 && /*#__PURE__*/ _react.default.createElement("div", {
                className: `${baseClass}__label`
            }, t('and')), /*#__PURE__*/ _react.default.createElement(_Condition.default, {
                andIndex: andIndex,
                dispatch: dispatchConditions,
                fields: reducedFields,
                key: andIndex,
                orIndex: orIndex,
                value: conditions[orIndex].and[andIndex]
            }))))))), /*#__PURE__*/ _react.default.createElement(_Button.default, {
        buttonStyle: "icon-label",
        className: `${baseClass}__add-or`,
        icon: "plus",
        iconPosition: "left",
        iconStyle: "with-border",
        onClick: ()=>{
            if (reducedFields.length > 0) dispatchConditions({
                type: 'add',
                field: reducedFields[0].value
            });
        }
    }, t('or'))), conditions.length === 0 && /*#__PURE__*/ _react.default.createElement("div", {
        className: `${baseClass}__no-filters`
    }, /*#__PURE__*/ _react.default.createElement("div", {
        className: `${baseClass}__label`
    }, t('noFiltersSet')), /*#__PURE__*/ _react.default.createElement(_Button.default, {
        buttonStyle: "icon-label",
        className: `${baseClass}__add-first-filter`,
        icon: "plus",
        iconPosition: "left",
        iconStyle: "with-border",
        onClick: ()=>{
            if (reducedFields.length > 0) dispatchConditions({
                type: 'add',
                field: reducedFields[0].value
            });
        }
    }, t('addFilter'))));
};
const _default = WhereBuilder;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9hZG1pbi9jb21wb25lbnRzL2VsZW1lbnRzL1doZXJlQnVpbGRlci9pbmRleC50c3giXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHF1ZXJ5U3RyaW5nIGZyb20gJ3FzJ1xuaW1wb3J0IFJlYWN0LCB7IHVzZVJlZHVjZXIsIHVzZVN0YXRlIH0gZnJvbSAncmVhY3QnXG5pbXBvcnQgeyB1c2VUcmFuc2xhdGlvbiB9IGZyb20gJ3JlYWN0LWkxOG5leHQnXG5pbXBvcnQgeyB1c2VIaXN0b3J5IH0gZnJvbSAncmVhY3Qtcm91dGVyLWRvbSdcblxuaW1wb3J0IHR5cGUgeyBGaWVsZCB9IGZyb20gJy4uLy4uLy4uLy4uL2V4cG9ydHMvdHlwZXMnXG5pbXBvcnQgdHlwZSB7IFdoZXJlIH0gZnJvbSAnLi4vLi4vLi4vLi4vdHlwZXMnXG5pbXBvcnQgdHlwZSB7IFByb3BzIH0gZnJvbSAnLi90eXBlcydcblxuaW1wb3J0IHsgdGFiSGFzTmFtZSB9IGZyb20gJy4uLy4uLy4uLy4uL2V4cG9ydHMvdHlwZXMnXG5pbXBvcnQgZmxhdHRlblRvcExldmVsRmllbGRzIGZyb20gJy4uLy4uLy4uLy4uL3V0aWxpdGllcy9mbGF0dGVuVG9wTGV2ZWxGaWVsZHMnXG5pbXBvcnQgeyBnZXRUcmFuc2xhdGlvbiB9IGZyb20gJy4uLy4uLy4uLy4uL3V0aWxpdGllcy9nZXRUcmFuc2xhdGlvbidcbmltcG9ydCB1c2VUaHJvdHRsZWRFZmZlY3QgZnJvbSAnLi4vLi4vLi4vaG9va3MvdXNlVGhyb3R0bGVkRWZmZWN0J1xuaW1wb3J0IHsgY3JlYXRlTmVzdGVkRmllbGRQYXRoIH0gZnJvbSAnLi4vLi4vZm9ybXMvRm9ybS9jcmVhdGVOZXN0ZWRGaWVsZFBhdGgnXG5pbXBvcnQgeyB1c2VTZWFyY2hQYXJhbXMgfSBmcm9tICcuLi8uLi91dGlsaXRpZXMvU2VhcmNoUGFyYW1zJ1xuaW1wb3J0IEJ1dHRvbiBmcm9tICcuLi9CdXR0b24nXG5pbXBvcnQgeyBjb21iaW5lTGFiZWwgfSBmcm9tICcuLi9GaWVsZFNlbGVjdCdcbmltcG9ydCBDb25kaXRpb24gZnJvbSAnLi9Db25kaXRpb24nXG5pbXBvcnQgZmllbGRUeXBlcyBmcm9tICcuL2ZpZWxkLXR5cGVzJ1xuaW1wb3J0ICcuL2luZGV4LnNjc3MnXG5pbXBvcnQgcmVkdWNlciBmcm9tICcuL3JlZHVjZXInXG5pbXBvcnQgeyB0cmFuc2Zvcm1XaGVyZVF1ZXJ5IH0gZnJvbSAnLi90cmFuc2Zvcm1XaGVyZVF1ZXJ5J1xuaW1wb3J0IHZhbGlkYXRlV2hlcmVRdWVyeSBmcm9tICcuL3ZhbGlkYXRlV2hlcmVRdWVyeSdcbmNvbnN0IGJhc2VDbGFzcyA9ICd3aGVyZS1idWlsZGVyJ1xuXG5leHBvcnQgdHlwZSBSZWR1Y2VDbGllbnRGaWVsZHNBcmdzID0ge1xuICBmaWVsZHM6IEZpZWxkW11cbiAgaTE4bjogYW55XG4gIGxhYmVsUHJlZml4Pzogc3RyaW5nXG4gIHBhdGhQcmVmaXg/OiBzdHJpbmdcbn1cblxuY29uc3QgcmVkdWNlRmllbGRzID0gKGZpZWxkcywgaTE4biwgbGFiZWxQcmVmaXgsIHBhdGhQcmVmaXgpID0+XG4gIGZsYXR0ZW5Ub3BMZXZlbEZpZWxkcyhmaWVsZHMpLnJlZHVjZSgocmVkdWNlZCwgZmllbGQpID0+IHtcbiAgICBsZXQgb3BlcmF0b3JzID0gW11cblxuICAgIGlmIChmaWVsZC5hZG1pbiAmJiAnZGlzYWJsZUxpc3RGaWx0ZXInIGluIGZpZWxkLmFkbWluICYmIGZpZWxkLmFkbWluPy5kaXNhYmxlTGlzdEZpbHRlcilcbiAgICAgIHJldHVybiByZWR1Y2VkXG5cbiAgICBpZiAoZmllbGQudHlwZSA9PT0gJ2dyb3VwJyAmJiAnZmllbGRzJyBpbiBmaWVsZCkge1xuICAgICAgY29uc3QgdHJhbnNsYXRlZExhYmVsID0gZ2V0VHJhbnNsYXRpb24oZmllbGQubGFiZWwgfHwgJycsIGkxOG4pXG5cbiAgICAgIGNvbnN0IGxhYmVsV2l0aFByZWZpeCA9IGxhYmVsUHJlZml4XG4gICAgICAgID8gdHJhbnNsYXRlZExhYmVsXG4gICAgICAgICAgPyBsYWJlbFByZWZpeCArICcgPiAnICsgdHJhbnNsYXRlZExhYmVsXG4gICAgICAgICAgOiBsYWJlbFByZWZpeFxuICAgICAgICA6IHRyYW5zbGF0ZWRMYWJlbFxuXG4gICAgICBjb25zdCBwYXRoV2l0aFByZWZpeCA9IGZpZWxkLm5hbWVcbiAgICAgICAgPyBwYXRoUHJlZml4XG4gICAgICAgICAgPyBwYXRoUHJlZml4ICsgJy4nICsgZmllbGQubmFtZVxuICAgICAgICAgIDogZmllbGQubmFtZVxuICAgICAgICA6IHBhdGhQcmVmaXhcblxuICAgICAgcmVkdWNlZC5wdXNoKC4uLnJlZHVjZUZpZWxkcyhmaWVsZC5maWVsZHMsIGkxOG4sIGxhYmVsV2l0aFByZWZpeCwgcGF0aFdpdGhQcmVmaXgpKVxuICAgICAgcmV0dXJuIHJlZHVjZWRcbiAgICB9XG5cbiAgICBpZiAoZmllbGQudHlwZSA9PT0gJ3RhYicgJiYgJ3RhYnMnIGluIGZpZWxkKSB7XG4gICAgICBjb25zdCB0YWJzID0gZmllbGQudGFicyBhcyBBcnJheTxhbnk+XG5cbiAgICAgIHRhYnMuZm9yRWFjaCgodGFiKSA9PiB7XG4gICAgICAgIGlmICh0eXBlb2YgdGFiLmxhYmVsICE9PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICBjb25zdCBsb2NhbGl6ZWRUYWJMYWJlbCA9IGdldFRyYW5zbGF0aW9uKHRhYi5sYWJlbCwgaTE4bilcblxuICAgICAgICAgIGNvbnN0IGxhYmVsV2l0aFByZWZpeCA9IGxhYmVsUHJlZml4XG4gICAgICAgICAgICA/IGxhYmVsUHJlZml4ICsgJyA+ICcgKyBsb2NhbGl6ZWRUYWJMYWJlbFxuICAgICAgICAgICAgOiBsb2NhbGl6ZWRUYWJMYWJlbFxuXG4gICAgICAgICAgY29uc3QgdGFiUGF0aFByZWZpeCA9XG4gICAgICAgICAgICB0YWJIYXNOYW1lKHRhYikgJiYgdGFiLm5hbWVcbiAgICAgICAgICAgICAgPyBwYXRoUHJlZml4XG4gICAgICAgICAgICAgICAgPyBwYXRoUHJlZml4ICsgJy4nICsgdGFiLm5hbWVcbiAgICAgICAgICAgICAgICA6IHRhYi5uYW1lXG4gICAgICAgICAgICAgIDogcGF0aFByZWZpeFxuXG4gICAgICAgICAgaWYgKHR5cGVvZiBsb2NhbGl6ZWRUYWJMYWJlbCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIHJlZHVjZWQucHVzaCguLi5yZWR1Y2VGaWVsZHModGFiLmZpZWxkcywgaTE4biwgbGFiZWxXaXRoUHJlZml4LCB0YWJQYXRoUHJlZml4KSlcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgICByZXR1cm4gcmVkdWNlZFxuICAgIH1cblxuICAgIGlmICgoZmllbGQudHlwZSBhcyBzdHJpbmcpID09PSAncm93JyAmJiAnZmllbGRzJyBpbiBmaWVsZCkge1xuICAgICAgcmVkdWNlZC5wdXNoKC4uLnJlZHVjZUZpZWxkcyhmaWVsZC5maWVsZHMsIGkxOG4sIGxhYmVsUHJlZml4LCBwYXRoUHJlZml4KSlcbiAgICAgIHJldHVybiByZWR1Y2VkXG4gICAgfVxuXG4gICAgaWYgKChmaWVsZC50eXBlIGFzIHN0cmluZykgPT09ICdjb2xsYXBzaWJsZScgJiYgJ2ZpZWxkcycgaW4gZmllbGQpIHtcbiAgICAgIGNvbnN0IGxvY2FsaXplZFRhYkxhYmVsID0gZ2V0VHJhbnNsYXRpb24oZmllbGQubGFiZWwgfHwgJycsIGkxOG4pXG5cbiAgICAgIGNvbnN0IGxhYmVsV2l0aFByZWZpeCA9IGxhYmVsUHJlZml4XG4gICAgICAgID8gbGFiZWxQcmVmaXggKyAnID4gJyArIGxvY2FsaXplZFRhYkxhYmVsXG4gICAgICAgIDogbG9jYWxpemVkVGFiTGFiZWxcblxuICAgICAgcmVkdWNlZC5wdXNoKC4uLnJlZHVjZUZpZWxkcyhmaWVsZC5maWVsZHMsIGkxOG4sIGxhYmVsV2l0aFByZWZpeCwgcGF0aFByZWZpeCkpXG4gICAgICByZXR1cm4gcmVkdWNlZFxuICAgIH1cblxuICAgIGlmICh0eXBlb2YgZmllbGRUeXBlc1tmaWVsZC50eXBlXSA9PT0gJ29iamVjdCcpIHtcbiAgICAgIGlmICh0eXBlb2YgZmllbGRUeXBlc1tmaWVsZC50eXBlXS5vcGVyYXRvcnMgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgb3BlcmF0b3JzID0gZmllbGRUeXBlc1tmaWVsZC50eXBlXS5vcGVyYXRvcnMoXG4gICAgICAgICAgJ2hhc01hbnknIGluIGZpZWxkICYmIGZpZWxkLmhhc01hbnkgPyB0cnVlIDogZmFsc2UsXG4gICAgICAgIClcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG9wZXJhdG9ycyA9IGZpZWxkVHlwZXNbZmllbGQudHlwZV0ub3BlcmF0b3JzXG4gICAgICB9XG5cbiAgICAgIGNvbnN0IG9wZXJhdG9yS2V5cyA9IG5ldyBTZXQoKVxuICAgICAgY29uc3QgcmVkdWNlZE9wZXJhdG9ycyA9IG9wZXJhdG9ycy5yZWR1Y2UoKGFjYywgb3BlcmF0b3IpID0+IHtcbiAgICAgICAgaWYgKCFvcGVyYXRvcktleXMuaGFzKG9wZXJhdG9yLnZhbHVlKSkge1xuICAgICAgICAgIG9wZXJhdG9yS2V5cy5hZGQob3BlcmF0b3IudmFsdWUpXG4gICAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgIC4uLmFjYyxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgLi4ub3BlcmF0b3IsXG4gICAgICAgICAgICAgIGxhYmVsOiBpMThuLnQoYG9wZXJhdG9yczoke29wZXJhdG9yLmxhYmVsfWApLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICBdXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGFjY1xuICAgICAgfSwgW10pXG5cbiAgICAgIGNvbnN0IGxvY2FsaXplZExhYmVsID0gZ2V0VHJhbnNsYXRpb24oZmllbGQubGFiZWwgfHwgZmllbGQubmFtZSwgaTE4bilcblxuICAgICAgY29uc3QgZm9ybWF0dGVkTGFiZWwgPSBsYWJlbFByZWZpeCA/IGNvbWJpbmVMYWJlbChsYWJlbFByZWZpeCwgZmllbGQsIGkxOG4pIDogbG9jYWxpemVkTGFiZWxcblxuICAgICAgY29uc3QgZm9ybWF0dGVkVmFsdWUgPSBwYXRoUHJlZml4XG4gICAgICAgID8gY3JlYXRlTmVzdGVkRmllbGRQYXRoKHBhdGhQcmVmaXgsIGZpZWxkIGFzIEZpZWxkKVxuICAgICAgICA6IGZpZWxkLm5hbWVcblxuICAgICAgY29uc3QgZm9ybWF0dGVkRmllbGQgPSB7XG4gICAgICAgIGxhYmVsOiBmb3JtYXR0ZWRMYWJlbCxcbiAgICAgICAgdmFsdWU6IGZvcm1hdHRlZFZhbHVlLFxuICAgICAgICAuLi5maWVsZFR5cGVzW2ZpZWxkLnR5cGVdLFxuICAgICAgICBvcGVyYXRvcnM6IHJlZHVjZWRPcGVyYXRvcnMsXG4gICAgICAgIHByb3BzOiB7XG4gICAgICAgICAgLi4uZmllbGQsXG4gICAgICAgIH0sXG4gICAgICB9XG5cbiAgICAgIHJlZHVjZWQucHVzaChmb3JtYXR0ZWRGaWVsZClcbiAgICAgIHJldHVybiByZWR1Y2VkXG4gICAgfVxuXG4gICAgcmV0dXJuIHJlZHVjZWRcbiAgfSwgW10pXG5cbi8qKlxuICogVGhlIFdoZXJlQnVpbGRlciBjb21wb25lbnQgaXMgdXNlZCB0byByZW5kZXIgdGhlIGZpbHRlciBjb250cm9scyBmb3IgYSBjb2xsZWN0aW9uJ3MgbGlzdCB2aWV3LlxuICogSXQgaXMgcGFydCBvZiB0aGUge0BsaW5rIExpc3RDb250cm9sc30gY29tcG9uZW50IHdoaWNoIGlzIHVzZWQgdG8gcmVuZGVyIHRoZSBjb250cm9scyAoc2VhcmNoLCBmaWx0ZXIsIHdoZXJlKS5cbiAqL1xuY29uc3QgV2hlcmVCdWlsZGVyOiBSZWFjdC5GQzxQcm9wcz4gPSAocHJvcHMpID0+IHtcbiAgY29uc3Qge1xuICAgIGNvbGxlY3Rpb246IHsgbGFiZWxzOiB7IHBsdXJhbCB9ID0ge30gfSA9IHt9LFxuICAgIGNvbGxlY3Rpb24sXG4gICAgaGFuZGxlQ2hhbmdlLFxuICAgIG1vZGlmeVNlYXJjaFF1ZXJ5ID0gdHJ1ZSxcbiAgfSA9IHByb3BzXG5cbiAgY29uc3QgaGlzdG9yeSA9IHVzZUhpc3RvcnkoKVxuICBjb25zdCBwYXJhbXMgPSB1c2VTZWFyY2hQYXJhbXMoKVxuICBjb25zdCB7IGkxOG4sIHQgfSA9IHVzZVRyYW5zbGF0aW9uKCdnZW5lcmFsJylcblxuICAvLyBUaGlzIGhhbmRsZXMgaW5pdGlhbGl6aW5nIHRoZSB3aGVyZSBjb25kaXRpb25zIGZyb20gdGhlIHNlYXJjaCBxdWVyeSAoVVJMKS4gVGhhdCB3YXksIGlmIHlvdSBwYXNzIGluXG4gIC8vIHF1ZXJ5IHBhcmFtcyB0byB0aGUgVVJMLCB0aGUgd2hlcmUgY29uZGl0aW9ucyB3aWxsIGJlIGluaXRpYWxpemVkIGZyb20gdGhvc2UgYW5kIGRpc3BsYXllZCBpbiB0aGUgVUkuXG4gIC8vIEV4YW1wbGU6IC9hZG1pbi9jb2xsZWN0aW9ucy9wb3N0cz93aGVyZVtvcl1bMF1bYW5kXVswXVt0ZXh0XVtlcXVhbHNdPWV4YW1wbGUlMjBwb3N0XG4gIGNvbnN0IFtjb25kaXRpb25zLCBkaXNwYXRjaENvbmRpdGlvbnNdID0gdXNlUmVkdWNlcihyZWR1Y2VyLCBwYXJhbXMud2hlcmUsICh3aGVyZUZyb21TZWFyY2gpID0+IHtcbiAgICBpZiAobW9kaWZ5U2VhcmNoUXVlcnkgJiYgd2hlcmVGcm9tU2VhcmNoKSB7XG4gICAgICBpZiAodmFsaWRhdGVXaGVyZVF1ZXJ5KHdoZXJlRnJvbVNlYXJjaCkpIHtcbiAgICAgICAgcmV0dXJuIHdoZXJlRnJvbVNlYXJjaC5vclxuICAgICAgfVxuXG4gICAgICAvLyBUcmFuc2Zvcm0gdGhlIHdoZXJlIHF1ZXJ5IHRvIGJlIGluIHRoZSByaWdodCBmb3JtYXQuIFRoaXMgd2lsbCB0cmFuc2Zvcm0gc29tZXRoaW5nIHNpbXBsZSBsaWtlIFt0ZXh0XVtlcXVhbHNdPWV4YW1wbGUlMjBwb3N0IHRvIHRoZSByaWdodCBmb3JtYXRcbiAgICAgIGNvbnN0IHRyYW5zZm9ybWVkV2hlcmUgPSB0cmFuc2Zvcm1XaGVyZVF1ZXJ5KHdoZXJlRnJvbVNlYXJjaClcblxuICAgICAgaWYgKHZhbGlkYXRlV2hlcmVRdWVyeSh0cmFuc2Zvcm1lZFdoZXJlKSkge1xuICAgICAgICByZXR1cm4gdHJhbnNmb3JtZWRXaGVyZS5vclxuICAgICAgfVxuXG4gICAgICBjb25zb2xlLndhcm4oJ0ludmFsaWQgd2hlcmUgcXVlcnkgaW4gVVJMLiBJZ25vcmluZy4nKVxuICAgIH1cbiAgICByZXR1cm4gW11cbiAgfSlcblxuICBjb25zdCBbcmVkdWNlZEZpZWxkc10gPSB1c2VTdGF0ZSgoKSA9PiByZWR1Y2VGaWVsZHMoY29sbGVjdGlvbi5maWVsZHMsIGkxOG4sIG51bGwsIG51bGwpKVxuXG4gIC8vIFRoaXMgaGFuZGxlcyB1cGRhdGluZyB0aGUgc2VhcmNoIHF1ZXJ5IChVUkwpIHdoZW4gdGhlIHdoZXJlIGNvbmRpdGlvbnMgY2hhbmdlXG4gIHVzZVRocm90dGxlZEVmZmVjdChcbiAgICAoKSA9PiB7XG4gICAgICBjb25zdCBjdXJyZW50UGFyYW1zID0gcXVlcnlTdHJpbmcucGFyc2UoaGlzdG9yeS5sb2NhdGlvbi5zZWFyY2gsIHtcbiAgICAgICAgZGVwdGg6IDEwLFxuICAgICAgICBpZ25vcmVRdWVyeVByZWZpeDogdHJ1ZSxcbiAgICAgIH0pIGFzIHsgd2hlcmU6IFdoZXJlIH1cblxuICAgICAgY29uc3QgcGFyYW1zVG9LZWVwID1cbiAgICAgICAgdHlwZW9mIGN1cnJlbnRQYXJhbXM/LndoZXJlID09PSAnb2JqZWN0JyAmJiAnb3InIGluIGN1cnJlbnRQYXJhbXMud2hlcmVcbiAgICAgICAgICA/IGN1cnJlbnRQYXJhbXMud2hlcmUub3IucmVkdWNlKChrZXB0UGFyYW1zLCBwYXJhbSkgPT4ge1xuICAgICAgICAgICAgICBjb25zdCBuZXdQYXJhbSA9IHsgLi4ucGFyYW0gfVxuICAgICAgICAgICAgICBpZiAocGFyYW0uYW5kKSB7XG4gICAgICAgICAgICAgICAgZGVsZXRlIG5ld1BhcmFtLmFuZFxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHJldHVybiBbLi4ua2VwdFBhcmFtcywgbmV3UGFyYW1dXG4gICAgICAgICAgICB9LCBbXSlcbiAgICAgICAgICA6IFtdXG5cbiAgICAgIGNvbnN0IGhhc05ld1doZXJlQ29uZGl0aW9ucyA9IGNvbmRpdGlvbnMubGVuZ3RoID4gMFxuXG4gICAgICBjb25zdCBuZXdXaGVyZVF1ZXJ5ID0ge1xuICAgICAgICAuLi4odHlwZW9mIGN1cnJlbnRQYXJhbXM/LndoZXJlID09PSAnb2JqZWN0JyAmJlxuICAgICAgICAodmFsaWRhdGVXaGVyZVF1ZXJ5KGN1cnJlbnRQYXJhbXM/LndoZXJlKSB8fCAhaGFzTmV3V2hlcmVDb25kaXRpb25zKVxuICAgICAgICAgID8gY3VycmVudFBhcmFtcy53aGVyZVxuICAgICAgICAgIDoge30pLFxuICAgICAgICBvcjogWy4uLmNvbmRpdGlvbnMsIC4uLnBhcmFtc1RvS2VlcF0sXG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHJlZHVjZWRRdWVyeSA9IHtcbiAgICAgICAgb3I6IG5ld1doZXJlUXVlcnkub3IubWFwKChvckNvbmRpdGlvbikgPT4ge1xuICAgICAgICAgIGNvbnN0IGFuZENvbmRpdGlvbnMgPSAob3JDb25kaXRpb24uYW5kIHx8IFtdKS5tYXAoKGFuZENvbmRpdGlvbikgPT4ge1xuICAgICAgICAgICAgY29uc3QgcmVkdWNlZENvbmRpdGlvbiA9IHt9XG4gICAgICAgICAgICBPYmplY3QuZW50cmllcyhhbmRDb25kaXRpb24pLmZvckVhY2goKFtmaWVsZE5hbWUsIGZpZWxkVmFsdWVdKSA9PiB7XG4gICAgICAgICAgICAgIE9iamVjdC5lbnRyaWVzKGZpZWxkVmFsdWUpLmZvckVhY2goKFtvcGVyYXRvcktleSwgb3BlcmF0b3JWYWx1ZV0pID0+IHtcbiAgICAgICAgICAgICAgICByZWR1Y2VkQ29uZGl0aW9uW2ZpZWxkTmFtZV0gPSB7fVxuICAgICAgICAgICAgICAgIHJlZHVjZWRDb25kaXRpb25bZmllbGROYW1lXVtvcGVyYXRvcktleV0gPSAhb3BlcmF0b3JWYWx1ZVxuICAgICAgICAgICAgICAgICAgPyB1bmRlZmluZWRcbiAgICAgICAgICAgICAgICAgIDogb3BlcmF0b3JWYWx1ZVxuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIHJldHVybiByZWR1Y2VkQ29uZGl0aW9uXG4gICAgICAgICAgfSlcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgYW5kOiBhbmRDb25kaXRpb25zLFxuICAgICAgICAgIH1cbiAgICAgICAgfSksXG4gICAgICB9XG5cbiAgICAgIGlmIChoYW5kbGVDaGFuZ2UpIGhhbmRsZUNoYW5nZShuZXdXaGVyZVF1ZXJ5IGFzIFdoZXJlKVxuXG4gICAgICBjb25zdCBoYXNFeGlzdGluZ0NvbmRpdGlvbnMgPVxuICAgICAgICB0eXBlb2YgY3VycmVudFBhcmFtcz8ud2hlcmUgPT09ICdvYmplY3QnICYmICdvcicgaW4gY3VycmVudFBhcmFtcy53aGVyZVxuXG4gICAgICBpZiAoXG4gICAgICAgIG1vZGlmeVNlYXJjaFF1ZXJ5ICYmXG4gICAgICAgICgoaGFzRXhpc3RpbmdDb25kaXRpb25zICYmICFoYXNOZXdXaGVyZUNvbmRpdGlvbnMpIHx8IGhhc05ld1doZXJlQ29uZGl0aW9ucylcbiAgICAgICkge1xuICAgICAgICBoaXN0b3J5LnJlcGxhY2Uoe1xuICAgICAgICAgIHNlYXJjaDogcXVlcnlTdHJpbmcuc3RyaW5naWZ5KFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAuLi5jdXJyZW50UGFyYW1zLFxuICAgICAgICAgICAgICBwYWdlOiAxLFxuICAgICAgICAgICAgICB3aGVyZTogcmVkdWNlZFF1ZXJ5LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHsgYWRkUXVlcnlQcmVmaXg6IHRydWUgfSxcbiAgICAgICAgICApLFxuICAgICAgICB9KVxuICAgICAgfVxuICAgIH0sXG4gICAgNTAwLFxuICAgIFtjb25kaXRpb25zLCBtb2RpZnlTZWFyY2hRdWVyeSwgaGFuZGxlQ2hhbmdlXSxcbiAgKVxuXG4gIHJldHVybiAoXG4gICAgPGRpdiBjbGFzc05hbWU9e2Jhc2VDbGFzc30+XG4gICAgICB7Y29uZGl0aW9ucy5sZW5ndGggPiAwICYmIChcbiAgICAgICAgPFJlYWN0LkZyYWdtZW50PlxuICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPXtgJHtiYXNlQ2xhc3N9X19sYWJlbGB9PlxuICAgICAgICAgICAge3QoJ2ZpbHRlcldoZXJlJywgeyBsYWJlbDogZ2V0VHJhbnNsYXRpb24ocGx1cmFsLCBpMThuKSB9KX1cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICA8dWwgY2xhc3NOYW1lPXtgJHtiYXNlQ2xhc3N9X19vci1maWx0ZXJzYH0+XG4gICAgICAgICAgICB7Y29uZGl0aW9ucy5tYXAoKG9yLCBvckluZGV4KSA9PiAoXG4gICAgICAgICAgICAgIDxsaSBrZXk9e29ySW5kZXh9PlxuICAgICAgICAgICAgICAgIHtvckluZGV4ICE9PSAwICYmIDxkaXYgY2xhc3NOYW1lPXtgJHtiYXNlQ2xhc3N9X19sYWJlbGB9Pnt0KCdvcicpfTwvZGl2Pn1cbiAgICAgICAgICAgICAgICA8dWwgY2xhc3NOYW1lPXtgJHtiYXNlQ2xhc3N9X19hbmQtZmlsdGVyc2B9PlxuICAgICAgICAgICAgICAgICAge0FycmF5LmlzQXJyYXkob3I/LmFuZCkgJiZcbiAgICAgICAgICAgICAgICAgICAgb3IuYW5kLm1hcCgoXywgYW5kSW5kZXgpID0+IChcbiAgICAgICAgICAgICAgICAgICAgICA8bGkga2V5PXthbmRJbmRleH0+XG4gICAgICAgICAgICAgICAgICAgICAgICB7YW5kSW5kZXggIT09IDAgJiYgPGRpdiBjbGFzc05hbWU9e2Ake2Jhc2VDbGFzc31fX2xhYmVsYH0+e3QoJ2FuZCcpfTwvZGl2Pn1cbiAgICAgICAgICAgICAgICAgICAgICAgIDxDb25kaXRpb25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgYW5kSW5kZXg9e2FuZEluZGV4fVxuICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNwYXRjaD17ZGlzcGF0Y2hDb25kaXRpb25zfVxuICAgICAgICAgICAgICAgICAgICAgICAgICBmaWVsZHM9e3JlZHVjZWRGaWVsZHN9XG4gICAgICAgICAgICAgICAgICAgICAgICAgIGtleT17YW5kSW5kZXh9XG4gICAgICAgICAgICAgICAgICAgICAgICAgIG9ySW5kZXg9e29ySW5kZXh9XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlPXtjb25kaXRpb25zW29ySW5kZXhdLmFuZFthbmRJbmRleF19XG4gICAgICAgICAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgICAgICAgIDwvbGk+XG4gICAgICAgICAgICAgICAgICAgICkpfVxuICAgICAgICAgICAgICAgIDwvdWw+XG4gICAgICAgICAgICAgIDwvbGk+XG4gICAgICAgICAgICApKX1cbiAgICAgICAgICA8L3VsPlxuICAgICAgICAgIDxCdXR0b25cbiAgICAgICAgICAgIGJ1dHRvblN0eWxlPVwiaWNvbi1sYWJlbFwiXG4gICAgICAgICAgICBjbGFzc05hbWU9e2Ake2Jhc2VDbGFzc31fX2FkZC1vcmB9XG4gICAgICAgICAgICBpY29uPVwicGx1c1wiXG4gICAgICAgICAgICBpY29uUG9zaXRpb249XCJsZWZ0XCJcbiAgICAgICAgICAgIGljb25TdHlsZT1cIndpdGgtYm9yZGVyXCJcbiAgICAgICAgICAgIG9uQ2xpY2s9eygpID0+IHtcbiAgICAgICAgICAgICAgaWYgKHJlZHVjZWRGaWVsZHMubGVuZ3RoID4gMClcbiAgICAgICAgICAgICAgICBkaXNwYXRjaENvbmRpdGlvbnMoeyB0eXBlOiAnYWRkJywgZmllbGQ6IHJlZHVjZWRGaWVsZHNbMF0udmFsdWUgfSlcbiAgICAgICAgICAgIH19XG4gICAgICAgICAgPlxuICAgICAgICAgICAge3QoJ29yJyl9XG4gICAgICAgICAgPC9CdXR0b24+XG4gICAgICAgIDwvUmVhY3QuRnJhZ21lbnQ+XG4gICAgICApfVxuICAgICAge2NvbmRpdGlvbnMubGVuZ3RoID09PSAwICYmIChcbiAgICAgICAgPGRpdiBjbGFzc05hbWU9e2Ake2Jhc2VDbGFzc31fX25vLWZpbHRlcnNgfT5cbiAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT17YCR7YmFzZUNsYXNzfV9fbGFiZWxgfT57dCgnbm9GaWx0ZXJzU2V0Jyl9PC9kaXY+XG4gICAgICAgICAgPEJ1dHRvblxuICAgICAgICAgICAgYnV0dG9uU3R5bGU9XCJpY29uLWxhYmVsXCJcbiAgICAgICAgICAgIGNsYXNzTmFtZT17YCR7YmFzZUNsYXNzfV9fYWRkLWZpcnN0LWZpbHRlcmB9XG4gICAgICAgICAgICBpY29uPVwicGx1c1wiXG4gICAgICAgICAgICBpY29uUG9zaXRpb249XCJsZWZ0XCJcbiAgICAgICAgICAgIGljb25TdHlsZT1cIndpdGgtYm9yZGVyXCJcbiAgICAgICAgICAgIG9uQ2xpY2s9eygpID0+IHtcbiAgICAgICAgICAgICAgaWYgKHJlZHVjZWRGaWVsZHMubGVuZ3RoID4gMClcbiAgICAgICAgICAgICAgICBkaXNwYXRjaENvbmRpdGlvbnMoeyB0eXBlOiAnYWRkJywgZmllbGQ6IHJlZHVjZWRGaWVsZHNbMF0udmFsdWUgfSlcbiAgICAgICAgICAgIH19XG4gICAgICAgICAgPlxuICAgICAgICAgICAge3QoJ2FkZEZpbHRlcicpfVxuICAgICAgICAgIDwvQnV0dG9uPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICl9XG4gICAgPC9kaXY+XG4gIClcbn1cblxuZXhwb3J0IGRlZmF1bHQgV2hlcmVCdWlsZGVyXG4iXSwibmFtZXMiOlsiYmFzZUNsYXNzIiwicmVkdWNlRmllbGRzIiwiZmllbGRzIiwiaTE4biIsImxhYmVsUHJlZml4IiwicGF0aFByZWZpeCIsImZsYXR0ZW5Ub3BMZXZlbEZpZWxkcyIsInJlZHVjZSIsInJlZHVjZWQiLCJmaWVsZCIsIm9wZXJhdG9ycyIsImFkbWluIiwiZGlzYWJsZUxpc3RGaWx0ZXIiLCJ0eXBlIiwidHJhbnNsYXRlZExhYmVsIiwiZ2V0VHJhbnNsYXRpb24iLCJsYWJlbCIsImxhYmVsV2l0aFByZWZpeCIsInBhdGhXaXRoUHJlZml4IiwibmFtZSIsInB1c2giLCJ0YWJzIiwiZm9yRWFjaCIsInRhYiIsImxvY2FsaXplZFRhYkxhYmVsIiwidGFiUGF0aFByZWZpeCIsInRhYkhhc05hbWUiLCJmaWVsZFR5cGVzIiwiaGFzTWFueSIsIm9wZXJhdG9yS2V5cyIsIlNldCIsInJlZHVjZWRPcGVyYXRvcnMiLCJhY2MiLCJvcGVyYXRvciIsImhhcyIsInZhbHVlIiwiYWRkIiwidCIsImxvY2FsaXplZExhYmVsIiwiZm9ybWF0dGVkTGFiZWwiLCJjb21iaW5lTGFiZWwiLCJmb3JtYXR0ZWRWYWx1ZSIsImNyZWF0ZU5lc3RlZEZpZWxkUGF0aCIsImZvcm1hdHRlZEZpZWxkIiwicHJvcHMiLCJXaGVyZUJ1aWxkZXIiLCJjb2xsZWN0aW9uIiwibGFiZWxzIiwicGx1cmFsIiwiaGFuZGxlQ2hhbmdlIiwibW9kaWZ5U2VhcmNoUXVlcnkiLCJoaXN0b3J5IiwidXNlSGlzdG9yeSIsInBhcmFtcyIsInVzZVNlYXJjaFBhcmFtcyIsInVzZVRyYW5zbGF0aW9uIiwiY29uZGl0aW9ucyIsImRpc3BhdGNoQ29uZGl0aW9ucyIsInVzZVJlZHVjZXIiLCJyZWR1Y2VyIiwid2hlcmUiLCJ3aGVyZUZyb21TZWFyY2giLCJ2YWxpZGF0ZVdoZXJlUXVlcnkiLCJvciIsInRyYW5zZm9ybWVkV2hlcmUiLCJ0cmFuc2Zvcm1XaGVyZVF1ZXJ5IiwiY29uc29sZSIsIndhcm4iLCJyZWR1Y2VkRmllbGRzIiwidXNlU3RhdGUiLCJ1c2VUaHJvdHRsZWRFZmZlY3QiLCJjdXJyZW50UGFyYW1zIiwicXVlcnlTdHJpbmciLCJwYXJzZSIsImxvY2F0aW9uIiwic2VhcmNoIiwiZGVwdGgiLCJpZ25vcmVRdWVyeVByZWZpeCIsInBhcmFtc1RvS2VlcCIsImtlcHRQYXJhbXMiLCJwYXJhbSIsIm5ld1BhcmFtIiwiYW5kIiwiaGFzTmV3V2hlcmVDb25kaXRpb25zIiwibGVuZ3RoIiwibmV3V2hlcmVRdWVyeSIsInJlZHVjZWRRdWVyeSIsIm1hcCIsIm9yQ29uZGl0aW9uIiwiYW5kQ29uZGl0aW9ucyIsImFuZENvbmRpdGlvbiIsInJlZHVjZWRDb25kaXRpb24iLCJPYmplY3QiLCJlbnRyaWVzIiwiZmllbGROYW1lIiwiZmllbGRWYWx1ZSIsIm9wZXJhdG9yS2V5Iiwib3BlcmF0b3JWYWx1ZSIsInVuZGVmaW5lZCIsImhhc0V4aXN0aW5nQ29uZGl0aW9ucyIsInJlcGxhY2UiLCJzdHJpbmdpZnkiLCJwYWdlIiwiYWRkUXVlcnlQcmVmaXgiLCJkaXYiLCJjbGFzc05hbWUiLCJSZWFjdCIsIkZyYWdtZW50IiwidWwiLCJvckluZGV4IiwibGkiLCJrZXkiLCJBcnJheSIsImlzQXJyYXkiLCJfIiwiYW5kSW5kZXgiLCJDb25kaXRpb24iLCJkaXNwYXRjaCIsIkJ1dHRvbiIsImJ1dHRvblN0eWxlIiwiaWNvbiIsImljb25Qb3NpdGlvbiIsImljb25TdHlsZSIsIm9uQ2xpY2siXSwicmFuZ2VNYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OyIsIm1hcHBpbmdzIjoiOzs7OytCQXlVQTs7O2VBQUE7OzsyREF6VXdCOytEQUNvQjs4QkFDYjtnQ0FDSjt1QkFNQTs4RUFDTztnQ0FDSDsyRUFDQTt1Q0FDTzs4QkFDTjsrREFDYjs2QkFDVTtrRUFDUDttRUFDQztRQUNoQjtnRUFDYTtxQ0FDZ0I7MkVBQ0w7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQy9CLE1BQU1BLFlB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